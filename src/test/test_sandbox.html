<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
  </head>
  <body>
    <script src="../mathworkers.js"></script>
	<script>
		// // Vector dot test
		// var MW = MathWorkers;

		// var type = "Float64";
		// var Nsize = 8000;

		// var v = new MW.Vector(type, Nsize);
		// var w = new MW.Vector(type, Nsize);
		// for (var i = 0; i < Nsize; i++) {
		//   v.setElement(i, i / 10000.0);
		//   w.setElement(i, i / 30000.0);
		// }

		// var serialStart = window.performance.now();
		// console.log(v.dot(w));
		// console.log("serial: " + (window.performance.now() - serialStart));

		// var workerStart = window.performance.now();
		// v.dot(w, 2).then(function(result) {
		//         console.log("workers: " + (window.performance.now() - workerStart));
		//         console.log("Result: " + result);
		// });
	</script>
	<script>
		// Matrix-Vector product test
		var MW = MathWorkers;

		var type = "Float64";
		var n = 3000;
		var ncols = n;
		var nrows = n;
		var nWorkers = 2;

		MW.ThreadPool(nWorkers); // start thread pool

		var vec = new MW.Vector(type, ncols);
		var mat = new MW.Matrix(type, nrows, ncols);
		for (var i = 0; i < ncols; i++) {
		  	vec.setElement(i, i * 1.0 + 1.0);
		}
		for (var i = 0; i < nrows; i++) {
		  	for (var j = 0; j < ncols; j++) {
		  		// mat.setElement(i, j, (i + j) / 100.0);
		  		mat.setElement(i, j, 0.0);
		  	}
		  	mat.setElement(i, i, 1.0);
		}

		console.log("sleeping... allow serial to start");
		setTimeout( function(){
			var serialStart = window.performance.now();
			var x = mat.timesVector(vec).getArray();
			console.log("serial: " + (window.performance.now() - serialStart));
			console.log(x);
		}, 1000);

		console.log("sleeping... allow workers to start");
		setTimeout( function(){

			var workerStart = window.performance.now();
			mat.timesVector(vec, nWorkers).then( function(result) {
			        console.log("workers: " + (window.performance.now() - workerStart));
			        console.log(result.getArray());
			});
		}, 2000);
	</script>
  </body>
</html>
