<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<title>MathWorkers Serial Unit Tests</title>
		<link href="./test.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
  		<!-- Display results of tests -->
  		<h1>MathWorkers Serial Unit Tests</h1>
  		
  		<h2>Vector tests</h2>
  		<ul>
  			<li>plus<div id="plus" class="pending">pending</div></li>
  			<li>minus<div id="minus" class="pending">pending</div></li>
  			<li>times<div id="times" class="pending">pending</div></li>
  			<li>dividedBy<div id="dividedBy" class="pending">pending</div></li>
  			<li>scale<div id="scale" class="pending">pending</div></li>
  			<li>apply<div id="apply" class="pending">pending</div></li>
			<li>dot<div id="dot" class="pending">pending</div></li>
  			<li>norm<div id="norm" class="pending">pending</div></li>
  			<li>sum<div id="sum" class="pending">pending</div></li>
  			<li>vectorMatrixMultiply<div id="vectorMatrixMultiply" class="pending">pending</div></li>
  		</ul>

  		<h2>Matrix tests</h2>
  		<ul>
			<li>matrixPlus<div id="matrixPlus" class="pending">pending</div></li>
			<li>matrixMinus<div id="matrixMinus" class="pending">pending</div></li>
			<li>matrixTimes<div id="matrixTimes" class="pending">pending</div></li>
			<li>matrixDividedBy<div id="matrixDividedBy" class="pending">pending</div></li>
			<li>matrixScale<div id="matrixScale" class="pending">pending</div></li>
			<li>matrixApply<div id="matrixApply" class="pending">pending</div></li>
			<li>matrixVectoryMultiply<div id="matrixVectorMultiply" class="pending">pending</div></li>
			<li>matrixTransposeSquare<div id="matrixTransposeSquare" class="pending">pending</div></li>
			<li>matrixTransposeRect<div id="matrixTransposeRect" class="pending">pending</div></li>
			<li>matrixTimesMatrix1<div id="matrixTimesMatrix1" class="pending">pending</div></li>
			<li>matrixTimesMatrix2<div id="matrixTimesMatrix2" class="pending">pending</div></li>
			<li>matrixTimesMatrix3<div id="matrixTimesMatrix3" class="pending">pending</div></li>
			<li>matrixTimesMatrix4<div id="matrixTimesMatrix4" class="pending">pending</div></li>
			<li>matrixTimesMatrix5<div id="matrixTimesMatrix5" class="pending">pending</div></li>
  		</ul>

  		<!-- Scripts to run test below (being loose with the indentation) -->
  		<script src="../src/mathworkers.js"></script>
  		<script src="unit_tester.js"></script>
 		<script>
/*
 * Serial tests
 */
var MWs = MathWorkers;
var Vector = MWs.Vector;
var Matrix = MWs.Matrix;
var UT = UnitTester;
var serialTests = [];

// Vector tests
serialTests.push( function() {
	var T = new UT.Tester("plus");
	var v = new MWs.Vector(3);
	var w = new MWs.Vector(3);
	for (var i = 0; i < 3; ++i) {
		v.set(i, i * 1.0);
		w.set(i, i * 2.0);
	}
	var plus = v.plus(w);
	var expected = Vector.fromArray([0.0, 3.0, 6.0]);
	T.vectorEqual(expected, plus);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("minus");
	var v = new MWs.Vector(3);
	var w = new MWs.Vector(3);
	for (var i = 0; i < 3; ++i) {
		v.set(i, (i+1) * 2.0);
		w.set(i, (i+1) * 1.0);
	}
	var minus = v.minus(w);
	var expected = Vector.fromArray([1.0, 2.0, 3.0]);
	T.vectorEqual(expected, minus);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("times");
	var v = Vector.fromArray([1.0, 2.0, 3.0]);
	var w = Vector.fromArray([4.0, 8.0, -3.0]);
	var times = v.times(w);
	var expected = Vector.fromArray([4.0, 16.0, -9.0]);
	T.vectorEqual(expected, times);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("dividedBy");
	var v = Vector.fromArray([1.0, 8.0, 3.0]);
	var w = Vector.fromArray([4.0, 2.0, -3.0]);
	var div = v.dividedBy(w);
	var expected = Vector.fromArray([0.25, 4.0, -1.0]);
	T.vectorEqual(expected, div);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("scale");
	var v = Vector.fromArray([0.25, 4.0, -30.0]);
	var sc = v.scale(2.0);
	var expected = Vector.fromArray([0.50, 8.0, -60.0]);
	T.vectorEqual(expected, sc);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("apply");
	var v = Vector.fromArray([1.0, 2.0, -3.0]);
	var app = v.apply(Math.exp);
	var expected = Vector.fromArray([Math.exp(1.0), Math.exp(2.0), Math.exp(-3.0)]);
	T.vectorEqual(expected, app);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("dot");
	var v = new MWs.Vector(3);
	var w = new MWs.Vector(3);
	for (var i = 0; i < 3; ++i) {
		v.set(i, i * 1.0);
		w.set(i, i * 2.0);
	}
	var dot = v.dot(w);
	T.doubleEqual(10.0, dot);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("norm");
	var v = Vector.fromArray([1.0, 2.0, -3.0]);
	var norm = v.norm();
	var expected = Math.sqrt(1.0 + 4.0 + 9.0);
	T.doubleEqual(expected, norm);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("sum");
	var v = Vector.fromArray([1.0, 2.0, -30.0]);
	var sum = v.sum();
	T.doubleEqual(-27.0, sum);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("vectorMatrixMultiply");
	var v = Vector.fromArray([1.0, 2.0, 3.0]);
	var A = Matrix.fromArray([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0]]);
	var w = v.timesMatrix(A);
	T.vectorEqual(Vector.fromArray([30.0, 36.0, 42.0]), w);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixPlus");
	var A = Matrix.fromArray([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0]]);
	var B = Matrix.fromArray([[3.0, 2.0, 1.0], [6.0, 5.0, 4.0], [9.0, 8.0, 7.0]]);
	var C = A.plus(B);
	T.matrixEqual(Matrix.fromArray([[4.0, 4.0, 4.0], [10.0, 10.0, 10.0], [16.0, 16.0, 16.0]]), C);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixMinus");
	var A = Matrix.fromArray([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0]]);
	var B = Matrix.fromArray([[3.0, 2.0, 1.0], [6.0, 5.0, 4.0], [9.0, 8.0, 7.0]]);
	var C = A.minus(B);
	T.matrixEqual(Matrix.fromArray([[-2.0, 0.0, 2.0], [-2.0, 0.0, 2.0], [-2.0, 0.0, 2.0]]), C);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixTimes");
	var A = Matrix.fromArray([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0]]);
	var B = Matrix.fromArray([[3.0, 2.0, 1.0], [6.0, 5.0, 4.0], [9.0, 8.0, 7.0]]);
	var C = A.times(B);
	T.matrixEqual(Matrix.fromArray([[3.0, 4.0, 3.0], [24.0, 25.0, 24.0], [63.0, 64.0, 63.0]]), C);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixDividedBy");
	var A = Matrix.fromArray([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0]]);
	var B = Matrix.fromArray([[3.0, 2.0, 1.0], [6.0, 5.0, 4.0], [9.0, 8.0, 7.0]]);
	var C = A.dividedBy(B);
	T.matrixEqual(Matrix.fromArray([[1.0/3.0, 1.0, 3.0], [4.0/6.0, 1.0, 6.0/4.0], [7.0/9.0, 1.0, 9.0/7.0]]), C);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixScale");
	var A = Matrix.fromArray([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0]]);
	var C = A.scale(3.0);
	T.matrixEqual(Matrix.fromArray([[3.0, 6.0, 9.0], [12.0, 15.0, 18.0], [21.0, 24.0, 27.0]]), C);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixApply");
	var A = Matrix.fromArray([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0]]);
	var C = A.apply(Math.sqrt);
	T.matrixEqual(Matrix.fromArray([[1.0, Math.sqrt(2.0), Math.sqrt(3.0)], 
									[2.0, Math.sqrt(5.0), Math.sqrt(6.0)], 
									[Math.sqrt(7.0), Math.sqrt(8.0), 3.0]]), C);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixVectorMultiply");
	var v = Vector.fromArray([1.0, 2.0, 3.0]);
	var A = Matrix.fromArray([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0]]);
	var w = A.timesVector(v);
	T.vectorEqual(Vector.fromArray([14.0, 32.0, 50.0]), w);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixTransposeSquare");
	var A = Matrix.fromArray([[1.0, 2.0, 3.0], 
		                      [4.0, 5.0, 6.0], 
		                      [7.0, 8.0, 9.0]]);
	T.matrixEqual(Matrix.fromArray([[1.0, 4.0, 7.0], 
		                            [2.0, 5.0, 8.0], 
		                            [3.0, 6.0, 9.0]]), A.transpose());
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixTransposeRect");
	var A = Matrix.fromArray([[1.0, 2.0, 3.0, 4.0, 5.0], 
							  [6.0, 7.0, 8.0, 9.0, 10.0],
							  [11.0, 12.0, 13.0, 14.0, 15.0]]);
	T.matrixEqual(Matrix.fromArray([[1.0, 6.0, 11.0],
									[2.0, 7.0, 12.0],
									[3.0, 8.0, 13.0],
									[4.0, 9.0, 14.0],
									[5.0, 10.0, 15.0]]), A.transpose());
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixTimesMatrix1");
	var A = Matrix.fromArray([[1.0, 2.0], 
							  [2.0, 3.0]]);
	var B = Matrix.fromArray([[-3.0, 2.0],
							  [1.0, -2.0]]);
	var AB = A.timesMatrix(B);
	T.matrixEqual(Matrix.fromArray([[-1.0, -2.0],
									[-3.0, -2.0]]), AB);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixTimesMatrix2");
	var A = Matrix.fromArray([[1.0, 2.0], 
							  [2.0, 3.0]]);
	var B = Matrix.fromArray([[-3.0, 2.0],
							  [1.0, -2.0]]);
	var BA = B.timesMatrix(A);
	T.matrixEqual(Matrix.fromArray([[1.0, 0.0],
									[-3.0, -4.0]]), BA);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixTimesMatrix3");
	var A = Matrix.fromArray([[1.0, 2.0], 
							  [2.0, 3.0]]);
	var C = Matrix.fromArray([[1.0, 0.0, -2.0], 
							  [0.0, 1.0, 1.0]]);
	var AC = A.timesMatrix(C);
	T.matrixEqual(Matrix.fromArray([[1.0, 2.0, 0.0],
									[2.0, 3.0, -1.0]]), AC);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixTimesMatrix4");
	var C = Matrix.fromArray([[1.0, 0.0, -2.0], 
							  [0.0, 1.0, 1.0]]);
	var D = Matrix.fromArray([[3.0, 1.0],
							  [-1.0, -2.0],
							  [1.0, 1.0]]);
	var CD = C.timesMatrix(D);
	T.matrixEqual(Matrix.fromArray([[1.0, -1.0],
									[0.0, -1.0]]), CD);
	T.passed();
});

serialTests.push( function() {
	var T = new UT.Tester("matrixTimesMatrix5");
	var C = Matrix.fromArray([[1.0, 0.0, -2.0], 
							  [0.0, 1.0, 1.0]]);
	var D = Matrix.fromArray([[3.0, 1.0],
							  [-1.0, -2.0],
							  [1.0, 1.0]]);
	var DC = D.timesMatrix(C);
	// console.log(DC.toString());
	T.matrixEqual(Matrix.fromArray([[3.0, 1.0, -5.0],
									[-1.0, -2.0, 0.0],
									[1.0, 1.0, -1.0]]), DC);
	T.passed();
});


serialTests.forEach( function(fn) {
	fn.call(this);
});
		</script>
  	</body>
</html>