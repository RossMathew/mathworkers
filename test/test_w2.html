<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<title>MathWorkers Multithreaded Unit Tests</title>
		<link href="./test.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
  		<!-- Display results of tests -->
  		<h1>MathWorkers Multithreaded Unit Tests</h1>
  		<h2>Communication tests</h2>
  		<ul>
   			<li>hello<div id="hello" class="pending">pending</div></li>
  			<li>sendVectorToCoordinator<div id="sendVectorToCoordinator" class="pending">pending</div></li>
  			<li>sendVectorToWorkers<div id="sendVectorToWorkers" class="pending">pending</div></li>
  		</ul>
  		<h2>Vector tests</h2>
  		<ul>
  			<li>vectorDot<div id="vectorDot" class="pending">pending</div></li>
  			<li>vectorPlus<div id="vectorPlus" class="pending">pending</div></li>
  			<li>vectorMinus<div id="vectorMinus" class="pending">pending</div></li>
  			<li>vectorTimes<div id="vectorTimes" class="pending">pending</div></li>
  			<li>vectorDividedBy<div id="vectorDividedBy" class="pending">pending</div></li>
  			<li>vectorScale<div id="vectorScale" class="pending">pending</div></li>
  			<li>vectorApply<div id="vectorApply" class="pending">pending</div></li>
  			<li>vectorNorm<div id="vectorNorm" class="pending">pending</div></li>
  			<li>vectorSum<div id="vectorSum" class="pending">pending</div></li>
  			<li>vectorTimesMatrix<div id="vectorTimesMatrix" class="pending">pending</div></li>
  		</ul>

  		<!-- Scripts to run test below (being loose with the indentation) -->
  		<script src="../src/mathworkers.js"></script>
  		<script src="unit_tester.js"></script>
		<script>
/*
 * MathWorker tests
 */
var MWs = MathWorkers;
var crd = new MWs.Coordinator(2, "test_w2_work.js", 3);
var UT = UnitTester;
var Vector = MWs.Vector;
var Matrix = MWs.Matrix;

crd.on("ready", function() {
	crd.trigger("run_hello");
});

crd.on("hello", function() {
	var T = new UT.Tester("hello");
	var messageList = crd.getMessages();
	T.equal("Hello from worker 0 of 2 workers.", messageList[0]);
	T.equal("Hello from worker 1 of 2 workers.", messageList[1]);
	T.passed();

	crd.trigger("run_sendVectorToCoordinator");
});

crd.on("sendVectorToCoordinator", function() {
	var T = new UT.Tester("sendVectorToCoordinator");
	var recv = crd.getBuffer();
	var vec = Vector.fromArray([0.0, 1.0, 2.0, 3.0, 4.0]);
	T.vectorEqual(vec, recv);
	T.passed();

	var vec = Vector.fromArray([0.0, 1.0, 2.0]);
	crd.sendVectorToWorkers(vec, "run_sendVectorToWorkers");
});

crd.on("sendVectorToWorkers", function() {
	var T = new UT.Tester("sendVectorToWorkers");
	var vec = Vector.fromArray([0.0, 1.0, 2.0]);
	var messageList = crd.getMessages();
	T.equal(vec.toString(), messageList[0]);
	T.equal(vec.toString(), messageList[1]);
	T.passed();

	crd.trigger("run_vectorDot");
});

crd.on("vectorDot", function() {
	var T = new UT.Tester("vectorDot");
	var recv = crd.getBuffer();
	T.doubleEqual(20.0, recv);
	T.passed();

	crd.trigger("run_vectorPlus");
});

crd.on("vectorPlus", function() {
	var T = new UT.Tester("vectorPlus");
	var recv = crd.getBuffer();
	var vec = Vector.fromArray([0.0, 2.0, 4.0, 6.0, 8.0]);
	T.vectorEqual(vec, recv);
	T.passed();

	crd.trigger("run_vectorMinus");
});

crd.on("vectorMinus", function() {
	var T = new UT.Tester("vectorMinus");
	var recv = crd.getBuffer();
	var vec = Vector.fromArray([1.0, 1.0, 1.0, 1.0, 1.0]);
	T.vectorEqual(vec, recv);
	T.passed();

	crd.trigger("run_vectorTimes");
});

crd.on("vectorTimes", function() {
	var T = new UT.Tester("vectorTimes");
	var recv = crd.getBuffer();
	var vec = Vector.fromArray([0.0, 2.0, 6.0, 12.0, 20.0]);
	T.vectorEqual(vec, recv);
	T.passed();

	crd.trigger("run_vectorDividedBy");
});

crd.on("vectorDividedBy", function() {
	var T = new UT.Tester("vectorDividedBy");
	var recv = crd.getBuffer();
	var vec = Vector.fromArray([0.0, 2.0, -2.0, 0.25, 1.0]);
	T.vectorEqual(vec, recv);
	T.passed();

	crd.trigger("run_vectorScale");
});

crd.on("vectorScale", function() {
	var T = new UT.Tester("vectorScale");
	var recv = crd.getBuffer();
	var vec = Vector.fromArray([2.0, 4.0, 6.0, 8.0, 10.0]);
	T.vectorEqual(vec, recv);
	T.passed();

	crd.trigger("run_vectorApply");
});

crd.on("vectorApply", function() {
	var T = new UT.Tester("vectorApply");
	var recv = crd.getBuffer();
	var vec = Vector.fromArray([Math.sqrt(1.0), Math.sqrt(2.0), Math.sqrt(3.0), Math.sqrt(4.0), Math.sqrt(5.0)]);
	T.vectorEqual(vec, recv);
	T.passed();

	crd.trigger("run_vectorNorm");
});

crd.on("vectorNorm", function() {
	var T = new UT.Tester("vectorNorm");
	var recv = crd.getBuffer();
	T.doubleEqual(Math.sqrt(1.0 + 4.0 + 9.0 + 16.0), recv);
	T.passed();

	crd.trigger("run_vectorSum");
});

crd.on("vectorSum", function() {
	var T = new UT.Tester("vectorSum");
	var recv = crd.getBuffer();
	T.doubleEqual(1500.0, recv);
	T.passed();

	crd.trigger("run_vectorTimesMatrix");
});

crd.on("vectorTimesMatrix", function() {
	var T = new UT.Tester("vectorTimesMatrix");
	var recv = crd.getBuffer();
	T.vectorEqual(Vector.fromArray([30.0, 36.0, 42.0]), recv);
	T.passed();

	// crd.trigger("run_vectorApply");
});

		</script>

  	</body>
</html>